<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>RESEARCHER USE ONLY — parameters input</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script src="assets/util.js" defer></script>
</head>
<body data-page="index">
  <div class="page">
    <div class="content">
      <div class="inner">
        <h1>RESEARCHER USE ONLY — parameters input</h1>

        <div class="form-grid">
          <label>
            Session
            <select id="sessionSelect" aria-label="session"></select>
          </label>

          <label>
            Participant preferred name (display only)
            <input type="text" id="nameInput" inputmode="text" autocomplete="off" />
          </label>

          <label>
            Participant code (saved)
            <input type="text" id="codeInput" inputmode="text" autocomplete="off" />
          </label>

          <label>
            Trial order (string of condition characters; optional for now)
            <input type="text" id="orderInput" inputmode="text" autocomplete="off" />
          </label>

          <label>
            Current trial index (integer; default 0)
            <input type="text" id="indexInput" value="0" inputmode="numeric" />
          </label>

          <label>
            Mode
            <select id="modeSelect" aria-label="mode">
              <option value="0" selected>Experiment (m=0)</option>
              <option value="1">Dev mode (m=1)</option>
            </select>
          </label>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="button-bar">
        <button id="nextBtn" class="primary">Next</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = VE.parseParams();

      // Populate sessions
      const sel = document.getElementById("sessionSelect");
      VE.SESSIONS.forEach(([label, code]) => {
        const opt = document.createElement("option");
        opt.value = code; opt.textContent = label;
        sel.appendChild(opt);
      });

      // Prefill from query (if any)
      if (params.s) sel.value = params.s;
      if (params.n) document.getElementById("nameInput").value  = params.n;
      if (params.p) document.getElementById("codeInput").value  = params.p;
      if (typeof params.t === "string") document.getElementById("orderInput").value = params.t;
      if (params.i) document.getElementById("indexInput").value = params.i;
      if (params.m) document.getElementById("modeSelect").value = params.m;

      // Next → param-check.html with built query
      document.getElementById("nextBtn").addEventListener("click", () => {
        const nextParams = {
          p: document.getElementById("codeInput").value.trim(),
          n: document.getElementById("nameInput").value.trim(),
          s: document.getElementById("sessionSelect").value,
          t: document.getElementById("orderInput").value.trim(),
          i: String(parseInt(document.getElementById("indexInput").value || "0", 10) || 0),
          m: document.getElementById("modeSelect").value
        };
        VE.goto("param-check.html", nextParams);
      });

      // Optional dev footer
      VE.renderDevFooter(params, "index");
    });
  </script>
</body>
</html>
